---
apiVersion: v1
kind: ConfigMap
metadata:
  name: hello-mlops-pipeline
  labels:
    app: kubeflow-pipeline
    pipeline: hello-mlops
data:
  pipeline.yaml: |
    # PIPELINE DEFINITION
    # Name: hello-mlops-pipeline
    # Description: A simple start to MLOps
    # Inputs:
    #    username: str [Default: 'CloudEngineer']
    components:
      comp-greeting-task:
        executorLabel: exec-greeting-task
        inputDefinitions:
          parameters:
            name:
              parameterType: STRING
        outputDefinitions:
          parameters:
            Output:
              parameterType: STRING
    deploymentSpec:
      executors:
        exec-greeting-task:
          container:
            args:
            - --executor_input
            - '{{$}}'
            - --function_to_execute
            - greeting_task
            command:
            - sh
            - -c
            - "\nif ! [ -x \"$(command -v pip)\" ]; then\n    python3 -m ensurepip ||\
              \ python3 -m ensurepip --user || apt-get install python3-pip\nfi\n\nPIP_DISABLE_PIP_VERSION_CHECK=1\
              \ python3 -m pip install --quiet --no-warn-script-location 'kfp==2.14.6'\
              \ '--no-deps' 'typing-extensions>=3.7.4,<5; python_version<\"3.9\"' && \"\
              $0\" \"$@\"\n"
            - sh
            - -ec
            - 'program_path=$(mktemp -d)


              printf "%s" "$0" > "$program_path/ephemeral_component.py"

              _KFP_RUNTIME=true python3 -m kfp.dsl.executor_main                         --component_module_path                         "$program_path/ephemeral_component.py"                         "$@"

              '
            - "\nimport kfp\nfrom kfp import dsl\nfrom kfp.dsl import *\nfrom typing import\
              \ *\n\ndef greeting_task(name: str) -> str:\n    \"\"\"This component greets\
              \ a user.\"\"\"\n    message = f\"Hello, {name}! Welcome to MLOps.\"\n \
              \   print(message)\n    return message\n\n"
            image: python:3.9-slim
    pipelineInfo:
      description: A simple start to MLOps
      name: hello-mlops-pipeline
    root:
      dag:
        tasks:
          greeting-task:
            cachingOptions:
              enableCache: true
            componentRef:
              name: comp-greeting-task
            inputs:
              parameters:
                name:
                  componentInputParameter: username
            taskInfo:
              name: greeting-task
      inputDefinitions:
        parameters:
          username:
            defaultValue: CloudEngineer
            isOptional: true
            parameterType: STRING
    schemaVersion: 2.1.0
    sdkVersion: kfp-2.14.6
