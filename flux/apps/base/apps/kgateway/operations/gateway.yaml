---
kind: Gateway
apiVersion: gateway.networking.k8s.io/v1
metadata:
  name: agentgateway
  labels:
    app: agentgateway
  annotations:
    # Exclude agentgateway admin ports from Istio interception to avoid conflicts
    traffic.sidecar.istio.io/excludeInboundPorts: "15000,15020,15021"
spec:
  gatewayClassName: agentgateway
  infrastructure:
    annotations:
      traffic.sidecar.istio.io/excludeInboundPorts: "15000,15020,15021"
      traffic.sidecar.istio.io/excludeOutboundPorts: "15000,15020"
  listeners:
  - protocol: HTTP
    port: 8080
    name: http
    allowedRoutes:
      namespaces:
        from: All
# Notes:
# Admin Console Access:
# The admin console listens on localhost:15000 only (by design for security)
# To access the admin UI, use port-forward:
#   kubectl port-forward -n apps pod/<agentgateway-pod-name> 15000:15000
# Then open: http://localhost:15000/ui