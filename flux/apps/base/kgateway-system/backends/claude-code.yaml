apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: claude-code
  namespace: kgateway-system
  labels:
    app: claude-code
    model: sonnet-4-5
    provider: anthropic
spec:
  gatewayClassName: agentgateway
  listeners:
    - name: http
      port: 8094
      protocol: HTTP
      allowedRoutes:
        namespaces:
          from: Same
---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: claude-code
  namespace: kgateway-system
  labels:
    app: claude-code
    model: sonnet-4-5
    provider: anthropic
spec:
  ai:
    groups:
      - providers:
          - name: anthropic
            anthropic:
              # Model is HARDCODED - client cannot override
              model: "claude-sonnet-4-5"
            policies:
              auth:
                secretRef:
                  name: anthropic-secret
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: claude-code
  namespace: kgateway-system
spec:
  parentRefs:
    - name: claude-code
      namespace: kgateway-system
      sectionName: http
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /v1/messages
        - path:
            type: PathPrefix
            value: /v1/models
      backendRefs:
        - name: claude-code
          namespace: kgateway-system
          group: agentgateway.dev
          kind: AgentgatewayBackend

