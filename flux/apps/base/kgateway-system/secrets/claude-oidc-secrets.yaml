---
# ============================================================================
# CLAUDE OIDC EXTERNAL SECRETS
# ============================================================================
# These ExternalSecrets pull OIDC client credentials from Bitwarden
# for Authentik OAuth2/OIDC applications.
#
# IMPORTANT: Before applying, you must:
# 1. Create OAuth2/OIDC applications in Authentik (see AUTHENTICATION.md)
# 2. Store client_id and client_secret in Bitwarden Secrets Manager
# 3. Replace <BITWARDEN-SECRET-ID-*> placeholders with actual Bitwarden UUIDs
# ============================================================================

# ============================================================================
# EXTERNAL SECRET 1: Claude Sonnet OIDC
# ============================================================================
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: claude-sonnet-oidc
  namespace: kgateway-system
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: bitwarden-secretsmanager
    kind: ClusterSecretStore
  target:
    name: claude-sonnet-oidc
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        client_id: '{{ .client_id | trimAll "\"" }}'
        client_secret: '{{ .client_secret | trimAll "\"" }}'
  data:
    - secretKey: client_id
      remoteRef:
        key: "<BITWARDEN-SECRET-ID-SONNET>"  # Replace with actual Bitwarden secret UUID
        property: client_id
    - secretKey: client_secret
      remoteRef:
        key: "<BITWARDEN-SECRET-ID-SONNET>"  # Replace with actual Bitwarden secret UUID
        property: client_secret

---
# ============================================================================
# EXTERNAL SECRET 2: Claude Opus OIDC
# ============================================================================
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: claude-opus-oidc
  namespace: kgateway-system
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: bitwarden-secretsmanager
    kind: ClusterSecretStore
  target:
    name: claude-opus-oidc
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        client_id: '{{ .client_id | trimAll "\"" }}'
        client_secret: '{{ .client_secret | trimAll "\"" }}'
  data:
    - secretKey: client_id
      remoteRef:
        key: "<BITWARDEN-SECRET-ID-OPUS>"  # Replace with actual Bitwarden secret UUID
        property: client_id
    - secretKey: client_secret
      remoteRef:
        key: "<BITWARDEN-SECRET-ID-OPUS>"  # Replace with actual Bitwarden secret UUID
        property: client_secret

---
# ============================================================================
# EXTERNAL SECRET 3: Claude Haiku OIDC
# ============================================================================
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: claude-haiku-oidc
  namespace: kgateway-system
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: bitwarden-secretsmanager
    kind: ClusterSecretStore
  target:
    name: claude-haiku-oidc
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        client_id: '{{ .client_id | trimAll "\"" }}'
        client_secret: '{{ .client_secret | trimAll "\"" }}'
  data:
    - secretKey: client_id
      remoteRef:
        key: "<BITWARDEN-SECRET-ID-HAIKU>"  # Replace with actual Bitwarden secret UUID
        property: client_id
    - secretKey: client_secret
      remoteRef:
        key: "<BITWARDEN-SECRET-ID-HAIKU>"  # Replace with actual Bitwarden secret UUID
        property: client_secret
